const form = document.querySelector('form');
const name = document.querySelector('#name');
const nameLabel = name.parentNode;
const email = document.querySelector('#email');
const emailLabel = email.parentNode;
const jobRoleSelect = document.querySelector('#title');
const otherRole = document.querySelector('#other-job-role');
const themeSelect = document.querySelector('#design');
const colorSelect = document.querySelector('#color');
const jsPuns = document.querySelectorAll('[data-theme="js puns"]');
const heartJs = document.querySelectorAll('[data-theme="heart js"]');
let listActivities = document.querySelector('#activities-box');
const activitiesLegend = listActivities.previousElementSibling;
const actCheckboxes = listActivities.querySelectorAll('input');
const totalHTML = document.querySelector('#activities-cost');
const creditCard = document.querySelector('#credit-card');
const ccNum = document.querySelector('#cc-num');
let ccLabel = ccNum.parentNode;
const cvvInput = document.querySelector('#cvv');
const cvvLabel = cvvInput.parentNode;
const zipInput = document.querySelector('#zip');
const zipLabel = zipInput.parentNode;
const paypal = document.querySelector('#paypal');
const bitcoin = document.querySelector('#bitcoin');
const selectPayment = document.querySelector('#payment');
const ccOption = selectPayment.querySelector('[value="credit-card"]');

// Focus on the name input when the page loads
name.focus();

otherRole.style.display = 'none';
colorSelect.disabled = 'true';


paypal.style.display = 'none';
bitcoin.style.display = 'none';

// Selects "Credit Card" as the default option when the page loads
ccOption.selected = true;

jobRoleSelect.addEventListener('change', e => {
    if (e.target.value === 'other') {
        otherRole.style.display = '';
    } else {
        otherRole.style.display = 'none';
    }
});

themeSelect.addEventListener('change', e => {
    const selection = e.target.value;
    if (selection) {
        colorSelect.disabled = '';
    }

    
    if (selection === 'js puns') {
        for (let i = 0; i < heartJs.length; i++) {
            heartJs[i].style.display = 'none';
            jsPuns[i].style.display = '';
        }
    } else if (selection === 'heart js') {
        for (let i = 0; i < heartJs.length; i++) {
            heartJs[i].style.display = '';
            jsPuns[i].style.display = 'none';
        }
    }
})


let total = 0;
listActivities.addEventListener('change', e => {
    let checkbox = e.target;

    if (checkbox.tagName === 'INPUT') {
        if (checkbox.checked) {
            total += +checkbox.dataset.cost;
        } else {
            total -= +checkbox.dataset.cost;
        }
    }
    totalHTML.textContent = `Total: $${total}`;
});





selectPayment.addEventListener('change', e => {
    let selection = e.target.value;
    if (selection === 'paypal') {
        paypal.style.display = '';
        bitcoin.style.display = 'none';
        creditCard.style.display = 'none';
    } else if (selection === 'bitcoin') {
        paypal.style.display = 'none';
        bitcoin.style.display = '';
        creditCard.style.display = 'none';
    } else {
        paypal.style.display = 'none';
        bitcoin.style.display = 'none';
        creditCard.style.display = '';
    }
});




const emailRegex = /^[^@]+@[^@.]+\.[a-z]+$/i;
const ccRegex = /^\d{13,16}$/;
const zipRegex = /^\d{5}$/;
const cvvRegex = /^\d{3}$/;

function toggleError(_element, _element2, _class, _text, e) {
    if (!_element2) {
        _element.className = _class;
        _element.textContent = _text;
    } else {
        if (_class === 'error') {
            _element.className = 'error'
            _element2.className = 'error-label';
        } else {
            _element.className = ''
            _element2.className = '';
        }
        _element2.firstChild.textContent = _text;
        e.preventDefault();
    }
}

form.addEventListener('submit', e => {
    listActivities = document.querySelector('#activities-box');

    if (name.value === '') {
        toggleError(name, nameLabel, 'error', 'Name: Can\'t be empty', e);
    }
    if (!emailRegex.test(email.value)) {
        toggleError(email, emailLabel, 'error', 'Email Address: Insert a valid email', e);
    }
    for (let i = 0; i < actCheckboxes.length; i++) {
        if (!actCheckboxes[i].checked) {
            toggleError(activitiesLegend, null, 'error-label', 'Register for Activities: Select at least one activity', e);
            break;
        }
    }



    

//cuando todo este bien no puede dar e.prevent


    
    if (!ccRegex.test(ccNum.value)) {
        
        toggleError(ccNum, ccLabel, 'error', 'Card Number: Enter a valid card number', e);
    } else {
        toggleError(ccNum, ccLabel, 'Card Number:', e);
    }
    
    if (!zipRegex.test(zipInput.value)) {
        toggleError(zipInput, zipLabel, 'error', 'Zip Code: Wrong value', e);
    } else {
        toggleError(zipInput, zipLabel, 'Zip Code:', e);
    }

    if (!cvvRegex.test(cvvInput.value)) {
        toggleError(cvvInput, cvvLabel, 'error', 'CVV: Wrong value', e);
    } else {
        toggleError(cvvInput, cvvLabel, 'CVV:', e);
    }

});



name.addEventListener('input', e => {
    if (e.target.value) {
        toggleError(name, nameLabel, '', 'Name: ');
    } else {
        toggleError(name, nameLabel, 'error', 'Name: Can\'t be empty', e);
    }
});

const inputTextList = document.querySelector('input[type="text"]');
for (let i = 0; i < inputTextList.length; i++) {
    inputTextList[i].addEventListener('input', e => {
        let valid = [
            {name: e.target.value},
            {cc: ccRegex.test(ccNum)},
            {zip: zipRegex.test(zipInput)},
            {cvv: cvvRegex.test(cvvInput)}
        ];
        if (valid[i]['name']) {
            toggleError(name, nameLabel, '', 'Name: ');    
        } else {
            toggleError(name, nameLabel, 'error', 'Name: Can\'t be empty', e);
        }

        if (valid[i]['cc']) {

        } else {

        }
    });
}



